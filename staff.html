<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Dashboard - Whisk & Whimsy</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Unified header */
    .site-header{
      background:rgba(0,0,0,0.9);
      padding: 12px 16px;
      border-bottom:1px solid rgba(255,215,0,0.3);
      position:sticky;
      top:0;
      z-index:100
    }
    @media(min-width: 640px) {
      .site-header {
        padding: 15px 30px;
      }
    }
    @media(min-width: 1024px) {
      .site-header {
        padding: 15px 50px;
      }
    }
    .header-inner{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto}
    .logo-container{display:flex;align-items:center;gap:12px}
    .logo-container img{width:50px;height:50px;border-radius:50%;border:2px solid gold;object-fit:cover}
    .site-title{font-size:1.4em;font-weight:700;background:linear-gradient(90deg,#ffd700,#fff3b0);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;color:inherit}
    .header-nav{display:flex;align-items:center;gap:12px}
    .header-nav .nav-link{color:#ffd700;text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600}
    .cart-btn{background:transparent;border:1px solid transparent;cursor:pointer;font-size:1em;color:#ffd700;padding:8px 12px;border-radius:8px}
    .cart-btn span{background:gold;color:#000;border-radius:999px;padding:2px 6px;margin-left:6px;font-weight:700}

    body {
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top, #0a0a0a, #000);
      color: #ffd700;
      margin: 0;
      min-height: 100vh;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.9);
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 2px 15px rgba(255, 215, 0, 0.15);
      flex-wrap: wrap;
      gap: 10px;
    }

    @media(min-width: 640px) {
      header {
        padding: 15px 30px;
        flex-wrap: nowrap;
      }
    }

    @media(min-width: 1024px) {
      header {
        padding: 15px 50px;
      }
    }
    
    h1 {
      font-size: 1.4em;
      margin: 0;
      white-space: nowrap;
    }
    
    @media(min-width: 640px) {
      h1 {
        font-size: 1.8em;
      }
    }

    .back-btn {
      background: transparent;
      color: #ffd700;
      border: 1px solid #ffd700;
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
    }
    
    /* Mobile responsive table container */
    .table-container {
      width: 95%;
      margin: 20px auto;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    @media(min-width: 768px) {
      .table-container {
        margin: 40px auto;
      }
    }
    
    table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      font-size: 0.85em;
    }

    @media(min-width: 640px) {
      table {
        font-size: 0.95em;
        min-width: 100%;
      }
    }

    @media(min-width: 1024px) {
      table {
        font-size: 1em;
      }
    }
    
    th, td {
      padding: 10px 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 215, 0, 0.2);
    }
    
    @media(min-width: 768px) {
      th, td {
        padding: 12px;
      }
    }
    
    th {
      background: rgba(255, 215, 0, 0.2);
      color: black;
      font-size: 0.9em;
    }
    
    @media(min-width: 768px) {
      th {
        font-size: 1em;
      }
    }
    
    select {
      background: black;
      color: gold;
      border: 1px solid gold;
      border-radius: 5px;
      padding: 6px 8px;
      font-size: 0.9em;
      width: 100%;
      max-width: 160px;
    }
    
    @media(min-width: 768px) {
      select {
        padding: 8px;
      }
    }
    
    button {
      background: linear-gradient(90deg, #ffd700, #ffcc33);
      color: black;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      white-space: nowrap;
    }
    
    @media(min-width: 768px) {
      button {
        padding: 8px 12px;
      }
    }
    
    button:hover {
      transform: scale(1.05);
    }

    .logout-btn {
      display: inline-block;
      background-color: #000;
      color: gold;
      padding: 8px 16px;
      border: 2px solid gold;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9em;
      white-space: nowrap;
    }
    
    @media(min-width: 640px) {
      .logout-btn {
        padding: 10px 20px;
        font-size: 1em;
      }
    }

    .logout-btn:hover {
      background-color: gold;
      color: black;
      box-shadow: 0 0 10px gold;
    }
    
    /* Header controls for mobile */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 95%;
      margin: 20px auto 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    @media(min-width: 768px) {
      .dashboard-header {
        margin: 40px auto 20px;
      }
    }
    
    .dashboard-title {
      color: #fff6b7;
      margin: 0;
      font-size: 1.2em;
    }
    
    @media(min-width: 768px) {
      .dashboard-title {
        font-size: 1.5em;
      }
    }
    
    .remove-all-btn {
      background: #d2b71d;
      color: #070101;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9em;
      white-space: nowrap;
    }
    
    @media(min-width: 768px) {
      .remove-all-btn {
        padding: 10px 16px;
      }
    }
    
    /* Mobile-specific adjustments */
    @media(max-width: 480px) {
      header {
        padding: 10px 12px;
      }
      
      h1 {
        font-size: 1.2em;
      }
      
      .logout-btn {
        padding: 6px 12px;
        font-size: 0.85em;
      }
      
      .dashboard-header {
        width: 92%;
      }
      
      .dashboard-title {
        font-size: 1.1em;
      }
      
      .remove-all-btn {
        padding: 6px 10px;
        font-size: 0.85em;
      }
      
      .table-container {
        width: 92%;
      }
      
      th, td {
        padding: 8px 6px;
        font-size: 0.85em;
      }
      
      select {
        font-size: 0.85em;
        padding: 5px;
      }
      
      button {
        padding: 5px 8px;
        font-size: 0.85em;
      }
    }
    
    /* Very small screens */
    @media(max-width: 360px) {
      h1 {
        font-size: 1.1em;
      }
      
      .logout-btn {
        padding: 5px 10px;
        font-size: 0.8em;
      }
      
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .remove-all-btn {
        align-self: flex-start;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Staff Dashboard üç∞</h1>
  <a href="login.html" class="logout-btn">‚éã Logout</a>
</header>

<div class="dashboard-header">
  <h2 class="dashboard-title">Customer Orders</h2>
  <button onclick="clearAllOrders()" class="remove-all-btn">üóëÔ∏è Remove All Customers</button>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Customer Name</th>
        <th>Address</th>
        <th>Phone</th>
        <th>Item Count</th>
        <th>Products</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="orderTable"></tbody>
  </table>
</div>

<script>
  const table = document.getElementById('orderTable');

  // Always read orders from localStorage when loading/updating so the dashboard
  // reflects the latest data (prevents stale in-memory copies).
  function loadOrders() {
    table.innerHTML = '';
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    orders.forEach((order, index) => {
      const row = document.createElement('tr');

      if (order && order.id) {
        // compute item count: sum qty if present, otherwise length of items array
        let itemCount = 0;
        if (Array.isArray(order.items)) {
          if (order.items.length && order.items[0].qty !== undefined) {
            itemCount = order.items.reduce((s, it) => s + (Number(it.qty) || 0), 0);
          } else {
            itemCount = order.items.length;
          }
        }

        row.innerHTML = `
          <td>${order.customerName || 'N/A'}</td>
          <td>${order.address || 'N/A'}</td>
          <td>${order.phone || 'N/A'}</td>
          <td>${itemCount}</td>
          <td>
            ${Array.isArray(order.items) ? order.items.map(item => {
              const qty = item.qty ? ` <small style="opacity:0.85">x${item.qty}</small>` : '';
              const price = item.subtotal !== undefined ? item.subtotal.toFixed(2) : (item.price ? Number(item.price).toFixed(2) : '0.00');
              return `<div>üç∞ ${item.name}${qty} - ‚Ç±${price}</div>`;
            }).join('') : ''}
          </td>
          <td>
            <select onchange="updateStatus(${index}, this.value)">
              <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
              <option value="Preparing" ${order.status === 'Preparing' ? 'selected' : ''}>Preparing</option>
              <option value="Out for Delivery" ${order.status === 'Out for Delivery' ? 'selected' : ''}>Out for Delivery</option>
              <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
            </select>
          </td>
          <td><button onclick="deleteOrder(${index})">Delete</button></td>
        `;
      }
      table.appendChild(row);
    });
  }

  function updateStatus(index, newStatus) {
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    if (!orders[index]) return;
    orders[index].status = newStatus;
    localStorage.setItem('orders', JSON.stringify(orders));
    loadOrders();
  }

  function deleteOrder(index) {
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    if (!orders[index]) return;
    if (confirm('Are you sure you want to delete this order?')) {
      orders.splice(index, 1);
      localStorage.setItem('orders', JSON.stringify(orders));
      loadOrders();
    }
  }

  function clearAllOrders() {
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    if (orders.length === 0) {
      alert('No customer orders to remove.');
      return;
    }
    if (confirm(`Remove all ${orders.length} customer order(s)? This action cannot be undone.`)) {
      localStorage.removeItem('orders');
      loadOrders();
      alert('All customer orders have been removed.');
    }
  }

  // Initial render
  loadOrders();
</script>

</body>
</html>
